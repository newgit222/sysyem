<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>支付宝口令红包 - 码商管理后台</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {if condition="$Think.cookie.yhk_order_refresh eq 1"}
  <meta http-equiv="refresh" content="30">
  {/if}
  {include file="/common/link"}

  <style>
    .layui-card-body fieldset {
      margin: 0;
      border: 1px solid #e6e6e6;
      padding: 10px 20px 5px 20px;
      color: #6b6b6b;
    }

    .layui-card .layui-table-view {

      margin-top: 10px;
    }

    .layui-table-cell {
      height: auto;
      overflow: visible;
      text-overflow: inherit;
      white-space: normal;
      word-break: break-all;
    }  </style>
</head>
<body layadmin-themealias="default">

<div class="layui-fluid">
  <div class="layui-card">
    <div class="layui-card-body">
      <fieldset id="searchFieldset_currentTableRenderId" class="table-search-fieldset layui-hide1">
        <legend>高级搜索</legend>
        <form class="layui-form layui-form-pane form-search">
          <div class="layui-form-item layui-inline">
            <label class="layui-form-label">订单号</label>
            <div class="layui-input-inline">
              <input id="c-order_no" name="order_no" data-search-op="=" value=""
                     placeholder="请输入订单号" class="layui-input">
            </div>
          </div>
          <div class="layui-form-item layui-inline">
            <label class="layui-form-label">付款人姓名</label>
            <div class="layui-input-inline">
              <input id="c-pay_username" name="pay_username" data-search-op="%*%" value=""
                     placeholder="请输入付款人姓名" class="layui-input">
            </div>
          </div>

          <div class="layui-form-item layui-inline">
            <label class="layui-form-label">开始时间</label>
            <div class="layui-input-block">
              <input type="text" name="start_time" class="layui-input app-laydate-item" placeholder="yyyy-MM-dd HH:mm:ss">
            </div>
          </div>
          <div class="layui-form-item layui-inline">
            <label class="layui-form-label">结束时间</label>
            <div class="layui-input-block">
              <input type="text" name="end_time" class="layui-input app-laydate-item" placeholder="yyyy-MM-dd HH:mm:ss">
            </div>
          </div>

          <div class="layui-form-item layui-inline" style="margin-left: 115px">
            <button type="submit" class="layui-btn layui-btn-normal" data-type="tableSearch"
                    data-table="currentTableRenderId" lay-submit
                    lay-filter="order-search"> 搜 索
            </button>
            <button type="reset" class="layui-btn layui-btn-primary"
                    data-table-reset="currentTableRenderId"> 重 置
            </button>
          </div>
        </form>
      </fieldset>
      <blockquote class="layui-elem-quote layui-text">
        当前订单总金额：<span id="amount" class="layui-badge layui-bg-black">{$fees.amount}</span> 元
      </blockquote>
      <table class="layui-hide" id="accountFlowList" lay-filter="accountFlowListFilter"></table>
    </div>
  </div>
</div>

<script type="text/html" id="table-order">
  {{#  if(d.status != 1 && d.status!=2 && d.status!=3) { }}
  <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="issueOrder">确认收款</a>
  {{# } }}
</script>

<script src="/public/static/member/lib/layui-v2.6.3/layui.js"></script>


<script>
  layui.use(['table', 'form', 'laydate'], function () {
    var   table = layui.table,
            $ = layui.$,
            u = layui.util,
            laydate = layui.laydate,
            form = layui.form;
    table.render({
      elem: '#accountFlowList'
      , url: "/member/channel/getAccountFlow?pay_code={:input('pay_code')}&code_id={:input('code_id')}"
      , defaultToolbar: []
      , toolbar: '#toolbarDemo'
      , page: true
      , response: {statusCode: 1}
      , cols: [[
         {field: 'pay_time', align:"center" , title: '交易时间', templet: function (d) {
            return u.toDateString(d.pay_time ,'MM-dd HH:mm:ss');
          }}
        ,{field: 'order_pay_price', align:"center" ,title: '实际收款金额'}
        ,{field: 'pay_username',  align:"center" ,title: '付款人姓名'}

        , {field: 'order_no', align:"center" , title: '订单号'}
      ]]
      , done: function () {
        $(".layui-table-main tr").each(function (index, val) {
          $(".layui-table-fixed").each(function () {
            $($(this).find(".layui-table-body tbody tr")[index]).height($(val).height());
          });
        });
        $(".layui-table-header tr").each(function (index, val) {
          $(".layui-table-fixed").each(function () {
            $($(this).find(".layui-table-header thead tr")[index]).height($(val).height());
          });
        });
      }
    });

    form.on('submit(order-search)', function (data) {
      table.reload('accountFlowList', {
        page: {
          curr: 1
        }
        , where: data.field
      }, 'data');
      $.ajax({
        url:"/member/channel/searchStats?pay_code={:input('pay_code')}&code_id={:input('code_id')}",
        type : 'get',
        data:data.field,
        dataType:'json',
        success : function(data) {
          console.log(data);
          $("#amount").text(data.data.amount);
        }
      })
      return false;
    });



    lay('.app-laydate-item').each(function(k,v){
      var  timestamp=(k==0)?' 00:00:00':" 00:00:00";
      var date=new Date();
      date.setHours('00');date.setMinutes('00');date.setSeconds('00');
      if(k==1){
        date.setHours('23');date.setMinutes('59');date.setSeconds('59');
      }
      laydate.render({
        elem: this,
        format: 'yyyy-MM-dd',type:'datetime'
        ,istime:false
        ,value:date
        ,trigger: 'click'
      });
    });


  });

</script>

</body>
</html>
