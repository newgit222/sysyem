

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>后台管理员</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="__ADMIN__/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="__ADMIN__/style/admin.css" media="all">
</head>
<body>

<div class="layui-fluid">
  <div class="layui-card">
<!--    <div class="layui-form layui-card-header layuiadmin-card-header-auto">-->
<!--      <div class="layui-form-item">-->
<!--        <div class="layui-inline">-->
<!--          <label class="layui-form-label">登录名</label>-->
<!--          <div class="layui-input-block">-->
<!--            <input type="text" name="username" placeholder="请输入登录名" autocomplete="off" class="layui-input">-->
<!--          </div>-->
<!--        </div>-->
<!--        <div class="layui-inline">-->
<!--          <label class="layui-form-label">管理邮箱</label>-->
<!--          <div class="layui-input-block">-->
<!--            <input type="text" name="email" placeholder="请输入管理邮箱" autocomplete="off" class="layui-input">-->
<!--          </div>-->
<!--        </div>-->
<!--        <div class="layui-inline">-->
<!--          <button class="layui-btn layuiadmin-btn-admin" lay-submit lay-filter="app-admin-user-search">-->
<!--            <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>-->
<!--          </button>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
    <div class="layui-card-body">
      <script type="text/html" id="toolbarDemo">
        <div class="layui-btn-container">
          <button class="layui-btn layui-btn-normal layui-btn-sm data-add-btn" lay-event="add"> 添加 </button>
        </div>
      </script>


      <table id="app-admin-user-manage" lay-filter="app-admin-user-manage"></table>
      <script type="text/html" id="buttonTpl">
        {{#  if(d.status == 1){ }}
        <button class="layui-btn layui-btn-xs">正常</button>
        {{#  } else { }}
        <button class="layui-btn layui-btn-danger layui-btn-xs">禁用</button>
        {{#  } }}
      </script>

      <script type="text/javascript" charset="utf-8" id="table-admin-status">

        <input type="checkbox" id="editAdminStatus" name="editAdminStatus" lay-filter="editAdminStatus" userid={{d.id}} lay-skin="switch" admin_status={{d.status}} lay-text="正常|禁用" {{d.status == 1 ? 'checked':''}} />


      </script>

      <script type="text/html" id="currentTableBar">
        <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="change_balance"><i class="layui-icon layui-icon-edit"></i>增减余额</a>
      </script>
    </div>
  </div>
</div>
<script src="/public/static/member/lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="/public/static/member/js/lay-config.js?v=2.0.0" charset="utf-8"></script>
<script>

  layui.use(['element','form', 'table'], function (exports) {
    var $ = layui.jquery,
            element = layui.element,
            u = layui.util,
            form = layui.form,
            layer = layui.layer,
            table = layui.table;

    form.on('switch(editAdminStatus)',function (data) {

      //获取所需属性值
      var admin_status = data.elem.attributes['admin_status'].nodeValue;
      var id = data.elem.attributes['userid'].nodeValue;
      //   console.log(ms_status)
      $.ajax({
        url:'editAdminStatus?userid=' + id,
        method:'post',
        data:{admin_status:admin_status},
        success:function(res){
          if(res.code == 1){
            window.location.fresh
            table.reload('app-admin-user-manage');
          }else{
            window.location.fresh
          }
        }
      })
    })

    table.render({
      elem: '#app-admin-user-manage',
      url: "{:url('getAdminList')}",
      toolbar: '#toolbarDemo',
      defaultToolbar: ['filter', 'exports', 'print', {
        title: '提示',
        layEvent: 'LAYTABLE_TIPS',
        icon: 'layui-icon-tips'
      }],
      cols: [[ {
        field: "id",
        width: 80,
        title: "ID",
        sort: !0
      }, {
        field: "username",
        title: "登录名"
      }, {
        field: "nickname",
        title: "昵称"
      },{
        field: "email",
        title: "邮箱"
      },
        {
          field: "balance",
          width: 100,
          title: "余额"
        },
        {
          title: "状态",
          width: 500,
          align: "center",
          width: 120,
          toolbar: "#table-admin-status"
        },
        {
          field: "create_time",
          title: "加入时间",
          sort: !0,
          templet: function(d) {return u.toDateString(d.jointime*1000); }
        }, {
          field: "status",
          title: "审核状态",
          templet: "#buttonTpl",
          minWidth: 80,
          align: "center"
        }, {
          title: "操作",
          width: 550,
          align: "center",
          fixed: "right",
          toolbar: "#currentTableBar"
        }]],
      limits: [10, 15, 20, 25, 50, 100],
      limit: 15,
      page: true,
      skin: 'line',
      done:function (res) {
        $('.layui-table-box').show();
        $('.book-box').hide();
      }
    });



    /**
     * toolbar监听事件
     */
    table.on('toolbar(app-admin-user-manage)', function (obj) {
      if (obj.event === 'add') {  // 监听添加操作
        layer.open({
          type: 2
          , title: '添加'
          , content: 'userAdd'
          , maxmin: true
          , area: ['60%', '80%']
          , btn: ['确定', '取消']
          , yes: function (index, layero) {
            var iframeWindow = window['layui-layer-iframe' + index]
                    , submitID = 'app-channel-submit'
                    , submit = layero.find('iframe').contents().find('#' + submitID);

            //监听提交
            iframeWindow.layui.form.on('submit(' + submitID + ')', function (obj) {
              var field = obj.field; //获取提交的字段
              $.ajax({
                url: 'userAdd',
                method: 'POST',
                data: field,
                success: function (res) {
                  if (res.code == 1) {
                    table.reload('app-admin-user-manage'); //数据刷新
                    layer.close(index); //关闭弹层
                  }
                  layer.msg(res.msg, {icon: res.code == 1 ? 1 : 2, time: 1500});

                }
              });
            });

            submit.trigger('click');
          }
        });
      }
    });


    table.on('tool(currentTableFilter)', function (obj) {
      var d = obj.data;
      if (obj.event === 'change_balance') {
        layer.open({
          type: 2,
          title: "增减余额",
          content: "changeBalance.html?id="+ d.id,
          maxmin: !0,
          area: ['80%', '60%'],
          btn: ["确定", "取消"],
          yes: function (index, layero) {
            var iframeWindow = window['layui-layer-iframe' + index]
                    , submitID = 'app-admin-change-balance-submit'
                    , submit = layero.find('iframe').contents().find('#' + submitID);

            //监听提交
            iframeWindow.layui.form.on('submit('+ submitID +')', function (obj) {
              var field = obj.field; //获取提交的字段
              // var index = layer.msg("加载中.....", {time: 0, shade: 0.01});
              console.log(field);
              $.post("changeBalance",field,function (res) {
                if (res.code == 1){
                  i.reload('app-admin-user-manage');
                  layer.close();
                }
                layer.msg(res.msg, {icon: res.code == 1 ? 1: 2,time: 1500}, function () {
                  window.location.href = document.location;
                });
              });
            });
            submit.trigger('click')

          }
        })
      }
    });


    table.on('tool(app-admin-user-manage)', function (obj) {
      var d = obj.data;
      if (obj.event === 'change_balance') {
        layer.open({
          type: 2,
          title: "增减余额",
          content: "changeBalance.html?id="+ d.id,
          maxmin: !0,
          area: ['80%', '60%'],
          btn: ["确定", "取消"],
          yes: function (index, layero) {
            var iframeWindow = window['layui-layer-iframe' + index]
                    , submitID = 'app-admin-change-balance-submit'
                    , submit = layero.find('iframe').contents().find('#' + submitID);

            iframeWindow.layui.form.on('submit('+ submitID +')', function (obj) {
              var field = obj.field; //获取提交的字段
              // var index = layer.msg("加载中.....", {time: 0, shade: 0.01});
              console.log(field);
              $.post("changeBalance",field,function (res) {
                if (res.code == 1){
                  // table.reload('app-admin-user-manage');
                  layer.close(index);
                }
                layer.msg(res.msg, {icon: res.code == 1 ? 1: 2,time: 1500}, function () {
                  window.location.href = document.location;
                });
              });
            });
            submit.trigger('click')

          },
          success: function(e, t) {}
        })
      }

    })


  })
</script>
</body>
</html>

