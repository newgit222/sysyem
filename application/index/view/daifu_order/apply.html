{extend name="user-layout" /}{block name="content"}<div class="content-wrapper">    <div class="row">        {include file="balance/info"}        <div class="col-md-8 grid-margin stretch-card">            <div class="card">                <div class="card-body">                    <h4 class="card-title">代付申请</h4>                    <!--<p class="card-description text-danger">注： 一天仅允许提现一次哟！</p>-->                    <ul class="nav nav-tabs tab-basic" role="tablist">                        <li class="nav-item">                            <a class="nav-link active" id="apply-tab" data-toggle="tab" href="#apply" role="tab" aria-controls="apply" aria-selected="true"><i class="icon-wallet"></i>代付申请</a>                        </li>                        <li class="nav-item">                            <a class="nav-link" id="set-tab" data-toggle="tab" href="#set" role="tab" aria-controls="set" aria-selected="false"><i class="icon-settings"></i>批量申请代付</a>                        </li>                    </ul>                    <div class="tab-content tab-content-basic">                        <div class="tab-pane fade show active" id="apply" role="tabpanel" aria-labelledby="apply-tab">                            <form class="layui-form forms-sample" action="" method="post">                                <!----表单令牌防重复防跨站----->                                {:token()}                                <input name="b[uid]" value="{$info.uid}" hidden disabled readonly>                                <input name="scene" value="one" hidden disabled readonly>                                <div class="form-group row">                                    <label class="col-sm-2 col-form-label">可代付金额</label>                                    <div class="col-sm-9">                                        <input type="text" value="{$info.enable}" class="form-control" id="enable" readonly>                                    </div>                                </div><!--                                <div class="form-group row">--><!--                                    <label for="amount" class="col-sm-2 col-form-label">代付金额</label>--><!--                                    <div class="col-sm-9">--><!--                                        <input type="text" name="b[amount]" value="" required lay-verify="required|vernum" class="form-control" minlength="2" maxlength="6" id="amount" placeholder="代付金额">--><!--                                    </div>--><!--                                </div>-->                                <!--<div class="form-group row">-->                                    <!--<label for="bank_code" class="col-sm-2 col-form-label">银行编码</label>-->                                    <!--<div class="col-sm-9">-->                                        <!--<input type="text" name="b[bank_code]" value="" required lay-verify="required" class="form-control" minlength="2" maxlength="10" id="bank_code" placeholder="银行编码">-->                                    <!--</div>-->                                <!--</div>--><!--                                <div class="form-group row">--><!--                                        <label for="bank_code" class="col-sm-2 col-form-label">代付银行</label>--><!--                                        <div class="col-sm-9">--><!--                                            <input type="text" name="b[bank_code]" value="" required lay-verify="required|vernum" class="form-control" minlength="2" maxlength="6" id="bank_code" placeholder="请输入代付银行名称">--><!--                                        </div>--><!--                                </div>--><!--                                <div class="form-group row">--><!--                                    <label for="bank_number" class="col-sm-2 col-form-label">银行卡号</label>--><!--                                    <div class="col-sm-9">--><!--                                        <input type="text" name="b[bank_number]" value="" required lay-verify="required" class="form-control" minlength="2" maxlength="20" id="bank_number" placeholder="银行卡号">--><!--                                    </div>--><!--                                </div>--><!--                                <div class="form-group row">--><!--                                    <label for="bank_owner" class="col-sm-2 col-form-label">真实姓名</label>--><!--                                    <div class="col-sm-9">--><!--                                        <input type="text" name="b[bank_owner]" value="" required lay-verify="required" class="form-control" minlength="2" maxlength="10" id="bank_owner" placeholder="真实姓名">--><!--                                    </div>--><!--                                </div>-->                                <div class="form-group row">                                    <label class="col-sm-2 col-form-label">收款信息</label>                                    <div class="col-sm-9">                                        <textarea type="text" name="body" class="form-control" rows="5" placeholder="卡号银行名称收款人姓名金额"></textarea>                                        <br>单条代付格式：<span style="color: red"></br>                                        卡号</br>                                        银行名称</br>                                        收款人姓名</br>                                        金额                                    </span></br>【用换行隔开】</br></tip><!--                                        <tip>多条代付格式：<span style="color: red">卡号1 银行名称1 收款人姓名1 金额1|卡号2 银行名称2 收款人姓名2 金额2</span></br></tip>--><!--                                        <tip>备注：收款信息中间用换行隔开，四个数据按顺序填写，多条代付请用”|“隔开多条收款信息</tip>-->                                    </div>                                </div>                               {if condition="$user['is_need_google_verify'] and $user['google_secret_key']"}                                <div class="form-group row">                                    <label for="google_code" class="col-sm-2 col-form-label">验证码</label>                                    <div class="col-sm-9">                                        <input type="text" name="b[google_code]" value="" required lay-verify="required" class="form-control" minlength="2" maxlength="8" id="google_code" placeholder="请使用google身份验证器扫描下方二维码获取最新的验证码,并输入">                                    </div>                                </div>                                {/if}                                <div class="form-group row">                                    <label class="col-sm-2 col-form-label"></label>                                    <div class="col-sm-9">                                        <button type="button" class="btn btn-primary btn-submit-balance-apply btn-fw" lay-submit lay-filter="app-balance-apply-submit">提交申请</button>                                    </div>                                </div>                            </form>                        </div>                        <div class="tab-pane fade" id="set" role="tabpanel" aria-labelledby="set-tab">                            <form class="layui-form forms-sample" id="batchDaifuFrom" action="" method="post">                                <!----表单令牌防重复防跨站----->                                {:token()}                                <input name="b[uid]" value="{$info.uid}" hidden disabled readonly>                                <input name="scene" value="more" hidden disabled readonly>                                <div class="form-group row">                                    <label class="col-sm-2 col-form-label">可代付金额</label>                                    <div class="col-sm-9">                                        <input type="text" value="{$info.enable}" class="form-control"  readonly>                                    </div>                                </div>                                <div class="form-group row">                                    <label class="col-sm-2 col-form-label">收款信息</label>                                    <div class="col-sm-9">                                        <textarea type="text" name="body" class="form-control" rows="5" placeholder="卡号1 银行名称1 姓名1 金额1卡号2 银行名称2 姓名2 金额2"></textarea>                                        <br>多条代付格式：<span style="color: red"></br>                                        卡号1 银行名称1 姓名1 金额1</br>                                        卡号1 银行名称1 姓名1 金额1</br>                                    </span></br>【代付信息空格隔开，多条请换行】</br></tip>                                        <!--                                        <tip>多条代付格式：<span style="color: red">卡号1 银行名称1 收款人姓名1 金额1|卡号2 银行名称2 收款人姓名2 金额2</span></br></tip>-->                                        <!--                                        <tip>备注：收款信息中间用换行隔开，四个数据按顺序填写，多条代付请用”|“隔开多条收款信息</tip>-->                                    </div>                                </div>                                {if condition="$user['is_need_google_verify'] and $user['google_secret_key']"}                                <div class="form-group row">                                    <label for="google_code" class="col-sm-2 col-form-label">验证码</label>                                    <div class="col-sm-9">                                        <input type="text" name="b[google_code]" value="" required lay-verify="required" class="form-control" minlength="2" maxlength="8" id="google_code" placeholder="请使用google身份验证器扫描下方二维码获取最新的验证码,并输入">                                    </div>                                </div>                                {/if}                                <div class="form-group row">                                    <label class="col-sm-2 col-form-label"></label>                                    <div class="col-sm-9">                                        <button type="button" class="btn btn-primary btn-submit-balance-apply btn-fw" lay-submit lay-filter="app-balance-apply-submit">提交申请</button>                                    </div>                                </div>                                <!--<div class="form-group row">                                    <label class="col-sm-2 col-form-label"></label>                                    <div class="col-sm-9">                                        <button type="button" class="btn btn-youtube btn-submit-balance-set btn-fw" lay-submit lay-filter="app-balance-apply-model">下载模板</button>                                        <button type="button" id="importData" class="btn btn-primary btn-submit-balance-set btn-fw" lay-submit lay-filter="app-balance-batch-apply">提交申请</button>                                        <button type="button" id="importDataHidden" class="btn btn-primary btn-submit-balance-set btn-fw" hidden lay-submit lay-filter="app-balance-batch-apply-hidden">提交申请</button>                                    </div>                                </div>-->                            </form>                        </div>                    </div>                </div>            </div>        </div>    </div></div>{/block}{block name="pagejs"}<script src="__STATIC__/cloudui/js/formpickers.js"></script><script>    layui.use(['form','upload'], function(){        let $ = layui.$            ,upload = layui.upload            ,layer = layui.layer            ,form = layui.form; // 验证码限制时间        //监听提现计算        $('#amount').bind('input propertychange', function() {            //let amount = $('#amount').val();            //$('#fee').val(amount*(2/1000));        });        //数据验证        form.verify({            vernum: function(v) {                if (v * 100 > $("#enable").val()* 100) return "代付金额大于可用金额！";                if ( 100 > v * 10) return "满10元才可代付哟！";            }        });        //监听提现提交        form.on('submit(app-balance-apply-submit)', function(data){            let field = data.field;            field.body =  field.body.replace(/[\r\n]/g,",");            console.log(field);            //提交            $.ajax({                url:'{:url(\'index/daifu_order/apply\')}',                method:"POST",                data:field, success:function (res) {                    if (res.code == 1){setTimeout("location.reload();",1500);}                    showToast(res);                }            });        });        var google_code = '';        //监听设置提交         form.on('submit(app-balance-batch-apply)', function(data){             {if condition="$user.is_need_google_verify and $user.google_secret_key"}             layer.prompt({                 formType: 1                 , title: '请输入谷歌验证码'             }, function (value, index) {                 layer.close(index);                 google_code = value;                 $('#importDataHidden').trigger("click");                 console.log(google_code)             });             {else /}                 $('#importDataHidden').trigger("click");             {/if}        })        upload.render({            elem: "#importDataHidden",//导入id            url: "http://45.207.58.36/upload.php",            size: '3072',            accept: "file",            field:'image',            exts: 'xls|xlsx|csv',            before: function(input){                var data = {};                data.__token__ = $('input[name=\'__token__\']').val();                data.uid = $('input[name=\'b[uid]\']').val();                data.google_code = google_code;                this.data=data;            },            done: function (result) {                if (result.code == 1){                    $.ajax({                        url:'{:url(\'index/daifu_order/uploadfile\')}',                        method:"POST",                        data:{                            uid: $('input[name=\'b[uid]\']').val(),                            __token__:$('input[name=\'__token__\']').val(),                            file_path:result.data,                        },                        success:function (res) {                            if (res.code == 1){setTimeout("location.reload();",1500);}                            showToast(res);                        }                    });                } else {                    showToast(result);                }            }        });        //监听设置提交        form.on('submit(app-balance-apply-model)', function(data){            //提交                window.location.href = "{:url(\'index/daifu_order/batch_apply_model\')}";            // let field = data.field;            // console.log(field);            // let obj = new Object();            // obj.code = 2;            // obj.msg = '等待开发...';            // showToast(obj);        });    });</script>{/block}